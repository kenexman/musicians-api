<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Farmers Market Musicians Signup</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Epilogue:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --acoustic-orange: #FF6B35;
      --vinyl-black: #1A1A1D;
      --amp-silver: #C5C6C7;
      --stage-purple: #7B2CBF;
      --melody-yellow: #FFD23F;
      --quiet-cream: #F8F9FA;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Epilogue', sans-serif;
      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
      color: var(--quiet-cream);
      line-height: 1.6;
      min-height: 100vh;
    }

    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 50px 20px 30px;
      position: relative;
    }

    h1 {
      font-family: 'Space Mono', monospace;
      font-size: 3.8rem;
      font-weight: 700;
      color: var(--melody-yellow);
      margin-bottom: 10px;
      letter-spacing: -2px;
      text-shadow: 0 0 30px rgba(255, 210, 63, 0.5);
      animation: glow 3s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 20px rgba(255, 210, 63, 0.3); }
      to { text-shadow: 0 0 40px rgba(255, 210, 63, 0.6); }
    }

    .subtitle {
      font-size: 1.3rem;
      color: var(--amp-silver);
      font-weight: 300;
      margin-bottom: 10px;
    }

    .info-banner {
      background: rgba(255, 107, 53, 0.15);
      border-left: 4px solid var(--acoustic-orange);
      padding: 15px 20px;
      border-radius: 8px;
      margin: 20px auto;
      max-width: 800px;
      font-size: 0.95rem;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .tab-button {
      padding: 14px 32px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid var(--acoustic-orange);
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Space Mono', monospace;
      font-size: 0.95rem;
      font-weight: 700;
      color: var(--acoustic-orange);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .tab-button:hover {
      background: var(--acoustic-orange);
      color: var(--vinyl-black);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 53, 0.4);
    }

    .tab-button.active {
      background: var(--melody-yellow);
      color: var(--vinyl-black);
      border-color: var(--melody-yellow);
      box-shadow: 0 4px 15px rgba(255, 210, 63, 0.3);
    }

    .card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
      margin-bottom: 30px;
    }

    .card-header {
      font-family: 'Space Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      color: var(--melody-yellow);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--acoustic-orange);
      text-transform: uppercase;
      letter-spacing: -1px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      font-weight: 600;
      color: var(--amp-silver);
      margin-bottom: 8px;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    input, select, textarea {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      font-family: 'Epilogue', sans-serif;
      font-size: 1rem;
      color: var(--quiet-cream);
      transition: all 0.3s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--acoustic-orange);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.2);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .date-card {
      background: linear-gradient(135deg, rgba(123, 44, 191, 0.2) 0%, rgba(26, 26, 29, 0.6) 100%);
      border: 2px solid rgba(123, 44, 191, 0.4);
      border-radius: 15px;
      padding: 25px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .date-card::before {
      content: '‚ô™';
      position: absolute;
      top: -20px;
      right: -10px;
      font-size: 6rem;
      opacity: 0.05;
      color: var(--melody-yellow);
    }

    .date-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(123, 44, 191, 0.4);
      border-color: var(--acoustic-orange);
    }

    .date-header {
      font-family: 'Space Mono', monospace;
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--melody-yellow);
      margin-bottom: 5px;
    }

    .date-subheader {
      font-size: 0.85rem;
      color: var(--amp-silver);
      margin-bottom: 15px;
    }

    .time-slot {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .time-slot.available {
      border-color: rgba(255, 210, 63, 0.5);
      background: rgba(255, 210, 63, 0.08);
    }

    .time-slot.booked {
      background: rgba(255, 107, 53, 0.08);
      border-color: rgba(255, 107, 53, 0.5);
    }

    .time-info {
      font-family: 'Space Mono', monospace;
      font-weight: 700;
      font-size: 0.95rem;
    }

    .performer-name {
      font-size: 0.85rem;
      color: var(--amp-silver);
      margin-top: 3px;
    }

    .status-badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .status-available {
      background: var(--melody-yellow);
      color: var(--vinyl-black);
    }

    .status-booked {
      background: var(--acoustic-orange);
      color: white;
    }

    .status-waitlist {
      background: var(--stage-purple);
      color: white;
    }

    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: 10px;
      font-family: 'Space Mono', monospace;
      font-size: 0.95rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--acoustic-orange) 0%, #d65429 100%);
      color: white;
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(255, 107, 53, 0.5);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--stage-purple) 0%, #5a1f94 100%);
      color: white;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(123, 44, 191, 0.5);
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 0.8rem;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      overflow: hidden;
    }

    .admin-table th {
      background: linear-gradient(135deg, var(--stage-purple) 0%, var(--acoustic-orange) 100%);
      color: white;
      padding: 16px;
      text-align: left;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.85rem;
    }

    .admin-table td {
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--quiet-cream);
    }

    .admin-table tr:hover {
      background: rgba(255, 107, 53, 0.1);
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
      backdrop-filter: blur(5px);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(48, 43, 99, 0.98) 0%, rgba(26, 26, 29, 0.98) 100%);
      border: 2px solid var(--acoustic-orange);
      border-radius: 20px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .success-message {
      background: linear-gradient(135deg, var(--acoustic-orange) 0%, var(--stage-purple) 100%);
      color: white;
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-group input[type="checkbox"] {
      width: auto;
      cursor: pointer;
      accent-color: var(--acoustic-orange);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(255, 107, 53, 0.2) 0%, rgba(123, 44, 191, 0.2) 100%);
      border: 2px solid rgba(255, 107, 53, 0.4);
      padding: 30px;
      border-radius: 15px;
      text-align: center;
    }

    .stat-number {
      font-family: 'Space Mono', monospace;
      font-size: 3rem;
      font-weight: 700;
      color: var(--melody-yellow);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--amp-silver);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .admin-login {
      max-width: 450px;
      margin: 100px auto;
    }

    .admin-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filter-bar {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .filter-bar select {
      flex: 1;
      min-width: 200px;
    }

    .stipend-info {
      background: rgba(255, 210, 63, 0.15);
      border: 2px solid var(--melody-yellow);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 25px;
      text-align: center;
    }

    .stipend-amount {
      font-family: 'Space Mono', monospace;
      font-size: 2rem;
      font-weight: 700;
      color: var(--melody-yellow);
    }

    .genre-tag {
      display: inline-block;
      background: rgba(197, 198, 199, 0.2);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.75rem;
      margin-right: 5px;
      margin-top: 5px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      font-size: 1.2rem;
      color: var(--melody-yellow);
    }

    .error-message {
      background: rgba(255, 107, 53, 0.2);
      border: 2px solid var(--acoustic-orange);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      color: var(--acoustic-orange);
    }

    .market-selector {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // API Base URL - change this to your server URL
    const API_URL = 'http://localhost:3000/api';

    // API Helper Functions
    const api = {
      async get(endpoint) {
        const response = await fetch(`${API_URL}${endpoint}`);
        return response.json();
      },
      async post(endpoint, data) {
        const response = await fetch(`${API_URL}${endpoint}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        return response.json();
      }
    };

    function App() {
      const [activeTab, setActiveTab] = useState('musician');
      const [markets, setMarkets] = useState([]);
      const [selectedMarket, setSelectedMarket] = useState(null);
      const [isAdmin, setIsAdmin] = useState(false);
      const [showModal, setShowModal] = useState(false);
      const [modalContent, setModalContent] = useState('');
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        loadMarkets();
      }, []);

      const loadMarkets = async () => {
        try {
          const result = await api.get('/markets');
          if (result.success) {
            setMarkets(result.markets);
            if (result.markets.length > 0) {
              setSelectedMarket(result.markets[0]);
            }
          }
        } catch (error) {
          console.error('Failed to load markets:', error);
        } finally {
          setLoading(false);
        }
      };

      if (loading) {
        return (
          <div className="app-container">
            <div className="loading">üéµ Loading markets...</div>
          </div>
        );
      }

      return (
        <div className="app-container">
          <header>
            <h1><span>‚ô™</span> LIVE AT THE MARKET <span>‚ô´</span></h1>
            <p className="subtitle">Summer Musicians Performance Signup</p>
            <div className="info-banner">
              üéµ Saturdays | May - October | 2-Hour Performance Slots | Stipend Provided
            </div>
          </header>

          {markets.length > 1 && (
            <div className="market-selector">
              <div className="card">
                <label>Select Market Location</label>
                <select 
                  value={selectedMarket?.id || ''}
                  onChange={(e) => {
                    const market = markets.find(m => m.id === parseInt(e.target.value));
                    setSelectedMarket(market);
                  }}
                >
                  {markets.map(market => (
                    <option key={market.id} value={market.id}>
                      {market.name} - {market.location}
                    </option>
                  ))}
                </select>
              </div>
            </div>
          )}

          <div className="nav-tabs">
            <button 
              className={`tab-button ${activeTab === 'musician' ? 'active' : ''}`}
              onClick={() => setActiveTab('musician')}
            >
              Musician Signup
            </button>
            <button 
              className={`tab-button ${activeTab === 'admin' ? 'active' : ''}`}
              onClick={() => setActiveTab('admin')}
            >
              Admin Dashboard
            </button>
          </div>

          {activeTab === 'musician' && selectedMarket && (
            <MusicianView 
              market={selectedMarket}
              setShowModal={setShowModal}
              setModalContent={setModalContent}
            />
          )}

          {activeTab === 'admin' && !isAdmin && (
            <AdminLogin setIsAdmin={setIsAdmin} />
          )}

          {activeTab === 'admin' && isAdmin && selectedMarket && (
            <AdminView market={selectedMarket} />
          )}

          {showModal && (
            <div className="modal-overlay" onClick={() => setShowModal(false)}>
              <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                {modalContent}
                <button className="btn btn-primary" style={{marginTop: '20px', width: '100%'}} onClick={() => setShowModal(false)}>
                  Close
                </button>
              </div>
            </div>
          )}
        </div>
      );
    }

    function MusicianView({ market, setShowModal, setModalContent }) {
      const [schedule, setSchedule] = useState([]);
      const [loading, setLoading] = useState(true);
      const [formData, setFormData] = useState({
        name: '',
        email: '',
        phone: '',
        music_genre: '',
        description: '',
        selected_slots: [],
        join_waitlist: false
      });
      const [submitting, setSubmitting] = useState(false);

      useEffect(() => {
        loadSchedule();
      }, [market]);

      const loadSchedule = async () => {
        try {
          setLoading(true);
          const result = await api.get(`/markets/${market.id}/schedule`);
          if (result.success) {
            setSchedule(result.schedule);
          }
        } catch (error) {
          console.error('Failed to load schedule:', error);
        } finally {
          setLoading(false);
        }
      };

      const handleInputChange = (e) => {
        const { name, value, type, checked } = e.target;
        setFormData(prev => ({
          ...prev,
          [name]: type === 'checkbox' ? checked : value
        }));
      };

      const handleSlotSelection = (slotId) => {
        setFormData(prev => ({
          ...prev,
          selected_slots: prev.selected_slots.includes(slotId)
            ? prev.selected_slots.filter(id => id !== slotId)
            : [...prev.selected_slots, slotId]
        }));
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        
        if (formData.selected_slots.length === 0) {
          alert('Please select at least one performance slot');
          return;
        }

        try {
          setSubmitting(true);
          const result = await api.post('/musicians/register', formData);
          
          if (result.success) {
            setModalContent(
              <div>
                <div className="success-message">
                  <h2 style={{marginBottom: '10px'}}>üé∏ You're All Set!</h2>
                  <p>Thanks for signing up, {formData.name}!</p>
                </div>
                <p><strong>Confirmed Performances:</strong> {result.booked_count}</p>
                <p><strong>Waitlist Positions:</strong> {result.waitlist_count}</p>
                <div style={{marginTop: '20px', fontSize: '0.9rem'}}>
                  {result.booking_details.map((booking, i) => (
                    <div key={i} style={{marginBottom: '10px', padding: '10px', background: 'rgba(255,255,255,0.05)', borderRadius: '8px'}}>
                      üìÖ {new Date(booking.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}<br/>
                      üïê {booking.time}<br/>
                      {booking.status === 'waitlist' && '‚è≥ Waitlist'}
                      {booking.status === 'confirmed' && '‚úÖ Confirmed'}
                    </div>
                  ))}
                </div>
                <p style={{marginTop: '15px', fontSize: '0.9rem', color: 'var(--amp-silver)'}}>
                  We'll send a confirmation email to {formData.email}
                </p>
              </div>
            );
            setShowModal(true);

            // Reset form and reload schedule
            setFormData({
              name: '',
              email: '',
              phone: '',
              music_genre: '',
              description: '',
              selected_slots: [],
              join_waitlist: false
            });
            loadSchedule();
          } else {
            alert('Registration failed: ' + result.error);
          }
        } catch (error) {
          alert('Registration failed: ' + error.message);
        } finally {
          setSubmitting(false);
        }
      };

      if (loading) {
        return <div className="loading">Loading schedule...</div>;
      }

      return (
        <div>
          <div className="card">
            <h2 className="card-header">Musician Registration</h2>
            
            <div className="stipend-info">
              <div className="stipend-amount">${market.stipend_amount} Stipend</div>
              <p style={{marginTop: '10px', fontSize: '0.9rem'}}>Per 2-hour performance</p>
            </div>

            <form onSubmit={handleSubmit}>
              <div className="form-group">
                <label>Performer/Band Name *</label>
                <input 
                  type="text" 
                  name="name" 
                  value={formData.name}
                  onChange={handleInputChange}
                  required 
                  placeholder="Your name or band name"
                />
              </div>

              <div className="form-group">
                <label>Email Address *</label>
                <input 
                  type="email" 
                  name="email" 
                  value={formData.email}
                  onChange={handleInputChange}
                  required 
                  placeholder="your.email@example.com"
                />
              </div>

              <div className="form-group">
                <label>Phone Number *</label>
                <input 
                  type="tel" 
                  name="phone" 
                  value={formData.phone}
                  onChange={handleInputChange}
                  required 
                  placeholder="(555) 555-5555"
                />
              </div>

              <div className="form-group">
                <label>Music Genre/Style *</label>
                <select 
                  name="music_genre" 
                  value={formData.music_genre}
                  onChange={handleInputChange}
                  required
                >
                  <option value="">Select genre...</option>
                  <option value="acoustic">Acoustic</option>
                  <option value="folk">Folk</option>
                  <option value="bluegrass">Bluegrass</option>
                  <option value="jazz">Jazz</option>
                  <option value="blues">Blues</option>
                  <option value="country">Country</option>
                  <option value="rock">Rock</option>
                  <option value="classical">Classical</option>
                  <option value="world">World Music</option>
                  <option value="other">Other</option>
                </select>
              </div>

              <div className="form-group">
                <label>Brief Description of Your Music</label>
                <textarea 
                  name="description" 
                  value={formData.description}
                  onChange={handleInputChange}
                  rows="3"
                  placeholder="Tell us about your sound, instruments, and performance style..."
                ></textarea>
              </div>

              <div className="checkbox-group">
                <input 
                  type="checkbox" 
                  name="join_waitlist" 
                  id="waitlist"
                  checked={formData.join_waitlist}
                  onChange={handleInputChange}
                />
                <label htmlFor="waitlist" style={{marginBottom: 0, textTransform: 'none'}}>
                  Add me to waitlist for booked slots (we'll email if someone cancels)
                </label>
              </div>

              <h3 style={{
                fontFamily: "'Space Mono', monospace",
                fontSize: '1.5rem',
                color: 'var(--melody-yellow)',
                marginTop: '30px',
                marginBottom: '20px'
              }}>
                Select Your Performance Dates
              </h3>

              <div className="calendar-grid">
                {schedule.map(dateSchedule => {
                  const date = new Date(dateSchedule.date + 'T12:00:00');
                  
                  return (
                    <div key={dateSchedule.date} className="date-card">
                      <div className="date-header">
                        {date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}
                      </div>
                      <div className="date-subheader">
                        {date.toLocaleDateString('en-US', { year: 'numeric' })}
                      </div>
                      
                      {dateSchedule.slots.map(slot => {
                        const isSelected = formData.selected_slots.includes(slot.slot_id);
                        
                        return (
                          <div 
                            key={slot.slot_id} 
                            className={`time-slot ${slot.is_available ? 'available' : 'booked'}`}
                            style={isSelected ? {borderColor: 'var(--melody-yellow)', borderWidth: '2px'} : {}}
                          >
                            <div>
                              <div className="time-info">
                                {slot.start_time.substring(0,5)} - {slot.end_time.substring(0,5)}
                              </div>
                              {!slot.is_available && (
                                <div className="performer-name">üéµ {slot.booking.musician_name}</div>
                              )}
                              {slot.waitlist_count > 0 && (
                                <div style={{fontSize: '0.75rem', color: 'var(--stage-purple)', marginTop: '3px'}}>
                                  {slot.waitlist_count} on waitlist
                                </div>
                              )}
                            </div>
                            <div>
                              {slot.is_available ? (
                                <button 
                                  type="button"
                                  className="btn btn-small btn-primary"
                                  onClick={() => handleSlotSelection(slot.slot_id)}
                                >
                                  {isSelected ? '‚úì Selected' : 'Select'}
                                </button>
                              ) : (
                                <span className="status-badge status-booked">Booked</span>
                              )}
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  );
                })}
              </div>

              <button 
                type="submit" 
                className="btn btn-primary" 
                style={{marginTop: '30px', width: '100%', padding: '18px'}}
                disabled={submitting}
              >
                {submitting ? 'Submitting...' : 'Submit Registration'}
              </button>
            </form>
          </div>
        </div>
      );
    }

    function AdminLogin({ setIsAdmin }) {
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');

      const handleLogin = async () => {
        try {
          const result = await api.post('/admin/login', { username, password });
          if (result.success) {
            setIsAdmin(true);
          } else {
            setError(result.error);
          }
        } catch (error) {
          setError('Login failed: ' + error.message);
        }
      };

      return (
        <div className="admin-login">
          <div className="card">
            <h2 className="card-header">Admin Access</h2>
            {error && <div className="error-message">{error}</div>}
            <div className="form-group">
              <label>Username</label>
              <input 
                type="text" 
                value={username}
                onChange={(e) => setUsername(e.target.value)}
                placeholder="Enter username"
              />
            </div>
            <div className="form-group">
              <label>Password</label>
              <input 
                type="password" 
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
                placeholder="Enter password"
              />
            </div>
            <button className="btn btn-primary" style={{width: '100%'}} onClick={handleLogin}>
              Login
            </button>
            <p style={{marginTop: '15px', fontSize: '0.85rem', color: 'var(--amp-silver)', textAlign: 'center'}}>
              Default: username: admin, password: admin123
            </p>
          </div>
        </div>
      );
    }

    function AdminView({ market }) {
      const [stats, setStats] = useState(null);
      const [bookings, setBookings] = useState([]);
      const [musicians, setMusicians] = useState([]);
      const [filterMonth, setFilterMonth] = useState('all');
      const [filterStatus, setFilterStatus] = useState('all');
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        loadData();
      }, [market, filterMonth, filterStatus]);

      const loadData = async () => {
        try {
          setLoading(true);
          
          const statsResult = await api.get(`/admin/stats?market_id=${market.id}`);
          if (statsResult.success) {
            setStats(statsResult.stats);
          }

          let bookingsQuery = `/admin/bookings?market_id=${market.id}`;
          if (filterMonth !== 'all') bookingsQuery += `&month=${filterMonth}`;
          if (filterStatus !== 'all') bookingsQuery += `&status=${filterStatus}`;
          
          const bookingsResult = await api.get(bookingsQuery);
          if (bookingsResult.success) {
            setBookings(bookingsResult.bookings);
          }

          const musiciansResult = await api.get('/musicians');
          if (musiciansResult.success) {
            setMusicians(musiciansResult.musicians);
          }
        } catch (error) {
          console.error('Failed to load admin data:', error);
        } finally {
          setLoading(false);
        }
      };

      const handleCancelBooking = async (bookingId) => {
        if (!confirm('Are you sure you want to cancel this booking?')) return;

        try {
          const result = await api.post(`/bookings/${bookingId}/cancel`, {
            reason: 'Cancelled by admin'
          });
          
          if (result.success) {
            if (result.promoted_musician) {
              alert(`Booking cancelled. ${result.promoted_musician} has been promoted from waitlist.`);
            } else {
              alert('Booking cancelled successfully.');
            }
            loadData();
          }
        } catch (error) {
          alert('Failed to cancel booking: ' + error.message);
        }
      };

      const handleMarkPaid = async (bookingId) => {
        try {
          const result = await api.post(`/bookings/${bookingId}/mark-paid`, {});
          if (result.success) {
            alert('Stipend marked as paid');
            loadData();
          }
        } catch (error) {
          alert('Failed to mark as paid: ' + error.message);
        }
      };

      if (loading) {
        return <div className="loading">Loading admin data...</div>;
      }

      return (
        <div>
          {stats && (
            <div className="stats-grid">
              <div className="stat-card">
                <div className="stat-number">{stats.booked_slots}</div>
                <div className="stat-label">Booked Slots</div>
              </div>
              <div className="stat-card">
                <div className="stat-number">{stats.available_slots}</div>
                <div className="stat-label">Available Slots</div>
              </div>
              <div className="stat-card">
                <div className="stat-number">{stats.total_musicians}</div>
                <div className="stat-label">Total Musicians</div>
              </div>
              <div className="stat-card">
                <div className="stat-number">{stats.total_waitlist}</div>
                <div className="stat-label">Waitlist Total</div>
              </div>
            </div>
          )}

          <div className="card">
            <h2 className="card-header">Performance Schedule</h2>

            <div className="filter-bar">
              <select value={filterMonth} onChange={(e) => setFilterMonth(e.target.value)}>
                <option value="all">All Months</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
              </select>
              <select value={filterStatus} onChange={(e) => setFilterStatus(e.target.value)}>
                <option value="all">All Status</option>
                <option value="confirmed">Confirmed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>

            <table className="admin-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Time</th>
                  <th>Performer</th>
                  <th>Genre</th>
                  <th>Contact</th>
                  <th>Stipend</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {bookings.map(booking => (
                  <tr key={booking.booking_id}>
                    <td>{new Date(booking.performance_date).toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}</td>
                    <td>{booking.start_time.substring(0,5)} - {booking.end_time.substring(0,5)}</td>
                    <td><strong>{booking.musician_name}</strong></td>
                    <td><span className="genre-tag">{booking.music_genre}</span></td>
                    <td>
                      <a href={`mailto:${booking.email}`} style={{color: 'var(--acoustic-orange)'}}>
                        {booking.email}
                      </a>
                      <div style={{fontSize: '0.8rem', marginTop: '3px'}}>{booking.phone}</div>
                    </td>
                    <td>
                      {booking.stipend_paid ? (
                        <span className="status-badge" style={{background: 'green'}}>Paid</span>
                      ) : (
                        <button 
                          className="btn btn-small"
                          onClick={() => handleMarkPaid(booking.booking_id)}
                        >
                          Mark Paid
                        </button>
                      )}
                    </td>
                    <td>
                      <div className="admin-actions">
                        {booking.status === 'confirmed' && (
                          <button 
                            className="btn btn-small"
                            style={{background: 'var(--clay)', color: 'white'}}
                            onClick={() => handleCancelBooking(booking.booking_id)}
                          >
                            Cancel
                          </button>
                        )}
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div className="card">
            <h2 className="card-header">All Registered Musicians</h2>
            <table className="admin-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Phone</th>
                  <th>Genre</th>
                  <th>Registered</th>
                </tr>
              </thead>
              <tbody>
                {musicians.map(musician => (
                  <tr key={musician.id}>
                    <td><strong>{musician.name}</strong></td>
                    <td>{musician.email}</td>
                    <td>{musician.phone}</td>
                    <td><span className="genre-tag">{musician.music_genre}</span></td>
                    <td>{new Date(musician.created_at).toLocaleDateString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
