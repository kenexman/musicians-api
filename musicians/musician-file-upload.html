<!-- Musician File Upload Component -->
<!-- Add this to the musician registration form -->

<style>
.file-upload-section {
  margin-top: 40px;
  padding: 30px;
  background: rgba(123, 44, 191, 0.1);
  border: 2px solid var(--stage-purple);
  border-radius: 15px;
}

.file-upload-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.file-upload-box {
  background: rgba(0, 0, 0, 0.3);
  border: 2px dashed rgba(255, 255, 255, 0.3);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
}

.file-upload-box:hover {
  border-color: var(--acoustic-orange);
  background: rgba(255, 107, 53, 0.1);
}

.file-upload-box.has-file {
  border-color: var(--melody-yellow);
  border-style: solid;
}

.file-upload-icon {
  font-size: 3rem;
  margin-bottom: 10px;
}

.file-upload-label {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--melody-yellow);
  margin-bottom: 5px;
}

.file-upload-hint {
  font-size: 0.85rem;
  color: var(--amp-silver);
  margin-top: 5px;
}

.file-preview {
  margin-top: 15px;
}

.file-preview img {
  max-width: 100%;
  max-height: 150px;
  border-radius: 10px;
  object-fit: cover;
}

.audio-preview {
  margin-top: 10px;
}

.audio-preview audio {
  width: 100%;
}

.file-info {
  margin-top: 10px;
  font-size: 0.85rem;
  color: var(--amp-silver);
}

.remove-file-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

.remove-file-btn:hover {
  background: #c82333;
  transform: scale(1.1);
}

.upload-all-btn {
  margin-top: 30px;
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, var(--stage-purple) 0%, #5a1f94 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-family: 'Space Mono', monospace;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: all 0.3s ease;
}

.upload-all-btn:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(123, 44, 191, 0.5);
}

.upload-all-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.upload-progress {
  margin-top: 15px;
  padding: 15px;
  background: rgba(255, 210, 63, 0.1);
  border-radius: 10px;
  text-align: center;
}
</style>

<script type="text/babel">
// Musician File Upload Component
function MusicianFileUpload({ musicianId, onUploadComplete }) {
  const [files, setFiles] = React.useState({
    music_sample: null,
    logo: null,
    headshot: null
  });
  
  const [previews, setPreviews] = React.useState({
    music_sample: null,
    logo: null,
    headshot: null
  });
  
  const [uploading, setUploading] = React.useState(false);
  const [uploadProgress, setUploadProgress] = React.useState('');

  const fileInputRefs = {
    music_sample: React.useRef(null),
    logo: React.useRef(null),
    headshot: React.useRef(null)
  };

  const handleFileSelect = (fileType, event) => {
    const file = event.target.files[0];
    if (!file) return;

    // Validate file size (10MB)
    if (file.size > 10 * 1024 * 1024) {
      alert('File size must be less than 10MB');
      return;
    }

    // Validate file type
    if (fileType === 'music_sample' && !file.type.startsWith('audio/')) {
      alert('Please select an audio file for music sample');
      return;
    }

    if ((fileType === 'logo' || fileType === 'headshot') && !file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }

    // Update files state
    setFiles(prev => ({ ...prev, [fileType]: file }));

    // Create preview
    if (fileType === 'music_sample') {
      const audioUrl = URL.createObjectURL(file);
      setPreviews(prev => ({ ...prev, [fileType]: audioUrl }));
    } else {
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreviews(prev => ({ ...prev, [fileType]: reader.result }));
      };
      reader.readAsDataURL(file);
    }
  };

  const removeFile = (fileType) => {
    setFiles(prev => ({ ...prev, [fileType]: null }));
    setPreviews(prev => ({ ...prev, [fileType]: null }));
    if (fileInputRefs[fileType].current) {
      fileInputRefs[fileType].current.value = '';
    }
  };

  const uploadFiles = async () => {
    if (!musicianId) {
      alert('Please register first before uploading files');
      return;
    }

    // Check if at least one file is selected
    const hasFiles = Object.values(files).some(f => f !== null);
    if (!hasFiles) {
      alert('Please select at least one file to upload');
      return;
    }

    try {
      setUploading(true);
      setUploadProgress('Preparing files...');

      const formData = new FormData();
      
      if (files.music_sample) {
        formData.append('music_sample', files.music_sample);
      }
      if (files.logo) {
        formData.append('logo', files.logo);
      }
      if (files.headshot) {
        formData.append('headshot', files.headshot);
      }

      setUploadProgress('Uploading files...');

      const response = await fetch(`${API_URL}/musicians/${musicianId}/upload`, {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (result.success) {
        setUploadProgress(`‚úÖ Successfully uploaded ${result.files.length} file(s)!`);
        
        // Reset form after 2 seconds
        setTimeout(() => {
          setFiles({ music_sample: null, logo: null, headshot: null });
          setPreviews({ music_sample: null, logo: null, headshot: null });
          setUploadProgress('');
          if (onUploadComplete) onUploadComplete(result.files);
        }, 2000);
      } else {
        throw new Error(result.error);
      }
    } catch (error) {
      alert('Upload failed: ' + error.message);
      setUploadProgress('');
    } finally {
      setUploading(false);
    }
  };

  const formatFileSize = (bytes) => {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
  };

  return (
    <div className="file-upload-section">
      <h3 style={{
        fontFamily: "'Space Mono', monospace",
        fontSize: '1.5rem',
        color: 'var(--melody-yellow)',
        marginBottom: '10px'
      }}>
        üìÅ Upload Your Media
      </h3>
      <p style={{ color: 'var(--amp-silver)', marginBottom: '20px' }}>
        Showcase your talent! Upload a music sample, your logo, and a professional headshot.
      </p>

      <div className="file-upload-grid">
        {/* Music Sample */}
        <div 
          className={`file-upload-box ${files.music_sample ? 'has-file' : ''}`}
          onClick={() => fileInputRefs.music_sample.current?.click()}
        >
          {files.music_sample && (
            <button
              className="remove-file-btn"
              onClick={(e) => { e.stopPropagation(); removeFile('music_sample'); }}
            >
              √ó
            </button>
          )}
          
          <div className="file-upload-icon">üéµ</div>
          <div className="file-upload-label">Music Sample</div>
          <div className="file-upload-hint">MP3, WAV, etc. (Max 10MB)</div>
          
          <input
            ref={fileInputRefs.music_sample}
            type="file"
            accept="audio/*"
            style={{ display: 'none' }}
            onChange={(e) => handleFileSelect('music_sample', e)}
          />
          
          {files.music_sample && (
            <div className="file-preview">
              <div className="file-info">
                <strong>{files.music_sample.name}</strong><br/>
                {formatFileSize(files.music_sample.size)}
              </div>
              {previews.music_sample && (
                <div className="audio-preview">
                  <audio controls src={previews.music_sample}>
                    Your browser does not support audio playback.
                  </audio>
                </div>
              )}
            </div>
          )}
        </div>

        {/* Logo */}
        <div 
          className={`file-upload-box ${files.logo ? 'has-file' : ''}`}
          onClick={() => fileInputRefs.logo.current?.click()}
        >
          {files.logo && (
            <button
              className="remove-file-btn"
              onClick={(e) => { e.stopPropagation(); removeFile('logo'); }}
            >
              √ó
            </button>
          )}
          
          <div className="file-upload-icon">üé®</div>
          <div className="file-upload-label">Band Logo</div>
          <div className="file-upload-hint">JPG, PNG (Max 10MB)</div>
          
          <input
            ref={fileInputRefs.logo}
            type="file"
            accept="image/*"
            style={{ display: 'none' }}
            onChange={(e) => handleFileSelect('logo', e)}
          />
          
          {files.logo && (
            <div className="file-preview">
              {previews.logo && (
                <img src={previews.logo} alt="Logo preview" />
              )}
              <div className="file-info">
                <strong>{files.logo.name}</strong><br/>
                {formatFileSize(files.logo.size)}
              </div>
            </div>
          )}
        </div>

        {/* Headshot */}
        <div 
          className={`file-upload-box ${files.headshot ? 'has-file' : ''}`}
          onClick={() => fileInputRefs.headshot.current?.click()}
        >
          {files.headshot && (
            <button
              className="remove-file-btn"
              onClick={(e) => { e.stopPropagation(); removeFile('headshot'); }}
            >
              √ó
            </button>
          )}
          
          <div className="file-upload-icon">üì∏</div>
          <div className="file-upload-label">Headshot</div>
          <div className="file-upload-hint">JPG, PNG (Max 10MB)</div>
          
          <input
            ref={fileInputRefs.headshot}
            type="file"
            accept="image/*"
            style={{ display: 'none' }}
            onChange={(e) => handleFileSelect('headshot', e)}
          />
          
          {files.headshot && (
            <div className="file-preview">
              {previews.headshot && (
                <img src={previews.headshot} alt="Headshot preview" />
              )}
              <div className="file-info">
                <strong>{files.headshot.name}</strong><br/>
                {formatFileSize(files.headshot.size)}
              </div>
            </div>
          )}
        </div>
      </div>

      {uploadProgress && (
        <div className="upload-progress">
          {uploadProgress}
        </div>
      )}

      <button
        className="upload-all-btn"
        onClick={uploadFiles}
        disabled={uploading || !Object.values(files).some(f => f !== null)}
      >
        {uploading ? 'Uploading...' : 'Upload Media Files'}
      </button>

      <p style={{ 
        marginTop: '15px', 
        fontSize: '0.85rem', 
        color: 'var(--amp-silver)',
        textAlign: 'center'
      }}>
        üí° Tip: High-quality files help us showcase your talent better!
      </p>
    </div>
  );
}

// Usage after successful musician registration:
/*
// In your registration form component:
const [musicianId, setMusicianId] = React.useState(null);
const [showFileUpload, setShowFileUpload] = React.useState(false);

// After successful registration:
if (result.success) {
  setMusicianId(result.musician_id);
  setShowFileUpload(true);
}

// In your JSX:
{showFileUpload && (
  <MusicianFileUpload 
    musicianId={musicianId}
    onUploadComplete={(files) => {
      console.log('Files uploaded:', files);
      // Optionally close modal or show success message
    }}
  />
)}
*/
</script>

<!-- Displaying Uploaded Files (for admin view): -->
<script type="text/babel">
function MusicianFilesDisplay({ musician }) {
  return (
    <div style={{ marginTop: '15px' }}>
      {/* Logo */}
      {musician.logo_url && (
        <div style={{ marginBottom: '10px' }}>
          <img 
            src={`${API_URL.replace('/api', '')}${musician.logo_url}`}
            alt="Logo"
            style={{ 
              maxWidth: '100px', 
              maxHeight: '100px', 
              borderRadius: '10px',
              marginRight: '10px'
            }}
          />
        </div>
      )}

      {/* Headshot */}
      {musician.headshot_url && (
        <div style={{ marginBottom: '10px' }}>
          <img 
            src={`${API_URL.replace('/api', '')}${musician.headshot_url}`}
            alt="Headshot"
            style={{ 
              maxWidth: '100px', 
              maxHeight: '100px', 
              borderRadius: '50%',
              objectFit: 'cover'
            }}
          />
        </div>
      )}

      {/* Music Sample */}
      {musician.music_sample_url && (
        <div style={{ marginTop: '10px' }}>
          <audio 
            controls 
            src={`${API_URL.replace('/api', '')}${musician.music_sample_url}`}
            style={{ width: '100%', maxWidth: '300px' }}
          >
            Your browser does not support audio playback.
          </audio>
        </div>
      )}
    </div>
  );
}
</script>
